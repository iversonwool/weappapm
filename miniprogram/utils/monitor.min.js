!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WeAppMonitor",[],t):"object"==typeof exports?exports.WeAppMonitor=t():e.WeAppMonitor=t()}(this||self,(function(){return function(){"use strict";var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}e.d(t,{default:function(){return j}});var i=wx.request;function s(e){if("object"==typeof e){var t=Array.isArray(e)?[]:{};for(var r in e)"object"==typeof e[r]?t[r]=s(e[r]):t[r]=e[r];return t}return e}function a(){var e=getCurrentPages(),t=e[e.length-1];return(null==t?void 0:t.route)||""}var c=[];function p(){return s(c)}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var f=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({code:"",env:"pro",version:"",platform:""},{report_url:"http://172.26.239.136:8578/iov/upload/public/sendBehavior",report_api:"ly.iov.h5.monitor.user.behavior.upload"}),l=f;var m={os:null!=wx.getDeviceInfo().system.match(/iOS/i)?"iOS":"Android"},d=g;var b,v=null;function y(e,t){void 0===t&&(t=3e3),function(e){c.push(e)}(e),v&&clearTimeout(v),v=setTimeout((function(){var e=p();e.length&&(!function(e,t){void 0===t&&(t=!1),l.report_url||console.error("请设置上传 url 地址");var r=JSON.stringify({type:"performance",platform:"h5",dataSource:m.os,h5Browser:"browser",h5SdkVersion:"1.0.1",h5BrowserVersion:"15.17.1",detail:{data:e}});console.info("[WEAPP_APM]",e),t?d(r):setTimeout((function(){d(r)}))}(e),c.length=0)}),t)}function g(e){i({url:l.report_url,header:{api:l.report_api},method:"POST",data:JSON.stringify(e)})}class h{constructor(){this.oldConsoleError=void 0,this.oldConsoleError=console.error,this._initObserver()}_initObserver(){this._composeErrorObserver()}_composeErrorObserver(){var e=this;console.error=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e.oldConsoleError.apply(e,r);var o=Date.now();y({type:"error",subType:"console-error",startTime:o,errData:r,pageURL:a(),timestamp:(new Date).getTime()})},wx.onError((function(e){var t=e.match(/([^(\s@]*):(\d+):(\d+)/);t&&y({type:"error",subType:"js",msg:e,line:t[2],column:t[3],errData:[e],pageURL:a(),startTime:Date.now(),timestamp:(new Date).getTime()})})),wx.onUnhandledRejection((function(e){y({type:"error",subType:"promise",errData:[e.reason],startTime:Date.now(),pageURL:a(),timestamp:(new Date).getTime()})}))}}class O{constructor(){this._initObserver()}_initObserver(){this._composeBehaviorObserver()}_composeBehaviorObserver(){y({type:"behavior",subType:"pv",startTime:Date.now(),pageURL:a(),referrer:"",timestamp:(new Date).getTime()})}}class w{constructor(){this._initObserver()}_initObserver(){var e=wx.getPerformance().createObserver((function(t){e&&e.disconnect(),t.getEntries().forEach((function(e){"firstContentfulPaint"===e.name?y({type:"performance",subType:"first-screen-paint",startTime:e.startTime,pageURL:a(),timestamp:(new Date).getTime()}):"largestContentfulPaint"===e.name?y({type:"performance",subType:"largest-contentful-paint",entryType:"largest-contentful-paint",target:"",startTime:e.startTime,name:"largest-contentful-paint",pageURL:a(),timestamp:(new Date).getTime()}):"firstRender"===e.name&&y({type:"performance",subType:e.name,startTime:e.startTime,timestamp:(new Date).getTime(),pageURL:a()})}))}));e.observe({entryTypes:["render"]})}}class T{constructor(){if(this.version="1.0.1",this.isInited=!1,this.option={},T.instance&&T.instance instanceof T)return console.debug("[Monitor] Monitor is already exists."),T.instance;T.instance=this,this.isInited=!1,this.option={defaultObserver:["error","behavior","performance"],log:{}},this._initMonitor()}_initMonitor(){this.isInited=!0,this._addBuiltInObserver(),console.info("%c Monitor %c v".concat(this.version," "),"padding: 2px 1px; border-radius: 3px 0 0 3px; color: #fff; background: #c52928; font-weight: bold;","padding: 2px 1px; border-radius: 0 3px 3px 0; color: #fff; background: #1f4f9a; font-weight: bold;")}_addBuiltInObserver(){wx.request=function(e){var{success:t,url:r,method:n,headers:s,fail:a}=e,c=t,p=a,u={type:"performance",subType:"wx.request",startTime:Date.now(),url:r,method:(n||"GET").toUpperCase(),headers:s||{},endTime:0,duration:0,status:0,success:!1,timestamp:0};i(o(o({},e),{},{success:function(e){var{statusCode:t,data:r}=e;c&&c(e),u.endTime=Date.now(),u.duration=u.endTime-u.startTime,u.status=t,u.success=!0,u.timestamp=(new Date).getTime(),y(u)},fail:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];p&&p(t),u.endTime=Date.now(),u.duration=u.endTime-u.startTime,u.status=0,u.success=!1,u.timestamp=(new Date).getTime(),y(u)}}))},new h,new O,new w}static get instance(){return b}static set instance(e){void 0===e||e instanceof T?b=e:console.debug("[Monitor] Cannot set `Monitor.instance` because the value is not the instance of Monitor.")}}var j=T;return t=t.default}()}));